name: Pull Request Activity Notifications

on:
  pull_request:
    types: [opened, closed, reopened]

jobs:
  activity_notifications:
    runs-on: ubuntu-latest
    steps:
      - name: Gather PR context
        id: context
        uses: actions/github-script@v4
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const pr = context.payload.pull_request;
            const title = pr.title;
            const author = pr.user.login;
            const projectName = context.payload.repository.full_name;
            const action = context.payload.action;
            
            console.log(`Action: ${action}`);
            console.log(`PR Title: ${prTitle}`);
            console.log(`PR Author: ${prCreator}`);
            console.log(`Project: ${repositoryName}`);
            
            return { title: title, author: author, project: projectName, action: action }

      - name: Send Discord Notification for opened PR
        if: ${{ github.event_name == 'pull_request' && github.event.action == 'opened' }}
        uses: Ilshidur/action-discord@master
        env:
          DISCORD_WEBHOOK: ${{ secrets.ACTIVITY_DISCORD_WEBHOOK_URL }}
        with:
          args: "‚ú®Ô∏è[New Pull Request] ${steps.context.outputs.title}\nProject: ${steps.context.outputs.project}\nAuthor: ${steps.context.outputs.author}\nLink: ${{ github.event.pull_request.html_url }}"

      - name: Send Discord Notification for closed PR
        if: ${{ github.event_name == 'pull_request' && github.event.action == 'closed' }}
        uses: Ilshidur/action-discord@master
        env:
          DISCORD_WEBHOOK: ${{ secrets.ACTIVITY_DISCORD_WEBHOOK_URL }}
        with:
          args: "‚úÖ[Pull Request Closed] ${steps.context.outputs.title}\nProject: ${steps.context.outputs.project}\nAuthor: ${steps.context.outputs.author}\nLink: ${{ github.event.pull_request.html_url }}"

      - name: Send Discord Notification for reopened PR
        if: ${{ github.event_name == 'pull_request' && github.event.action == 'reopened' }}
        uses: Ilshidur/action-discord@master
        env:
          DISCORD_WEBHOOK: ${{ secrets.ACTIVITY_DISCORD_WEBHOOK_URL }}
        with:
          args: "üõ†Ô∏è[Pull Request Reopened] ${steps.context.outputs.title}\nProject: ${steps.context.outputs.project}\nAuthor: ${steps.context.outputs.author}\nLink: ${{ github.event.pull_request.html_url }}"
